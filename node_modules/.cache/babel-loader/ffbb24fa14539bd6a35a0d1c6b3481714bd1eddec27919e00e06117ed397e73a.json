{"ast":null,"code":"import axios from\"axios\";import{getUserTimezone}from\"@helpers/timezone\";import{subscribeOnStream,unsubscribeFromStream}from\"./streaming\";import store from\"../../../../../redux/store\";const configurationData={supported_resolutions:[\"1\",\"5\",\"10\",\"15\",\"30\"]};let numberOfEmptyRequests=0;export default{onReady:callback=>{setTimeout(()=>callback(configurationData));},getBars:async(symbolInfo,resolution,periodParams,onHistoryCallback)=>{try{let from=Math.floor(periodParams.from);let to=Math.floor(periodParams.to);const intervalMap={'1':'1m','5':'5m','15':'15m','30':'30m','60':'1h','240':'4h','D':'1d','W':'1w','M':'1M'};const interval=intervalMap[resolution]||'1m';const resp=await axios.get(\"https://fapi.binance.com/fapi/v1/klines\",{params:{symbol:symbolInfo.ticker.toLowerCase(),interval:interval,startTime:from*1000,endTime:to*1000,limit:1000}});const data=resp.data.map(obj=>({time:obj[0],open:parseFloat(obj[1]),high:parseFloat(obj[2]),low:parseFloat(obj[3]),close:parseFloat(obj[4]),volume:parseFloat(obj[5])}));if(data.length<1){numberOfEmptyRequests+=1;if(numberOfEmptyRequests>3){onHistoryCallback([],{noData:true});}else{onHistoryCallback([],{nextTime:periodParams.from-86400});}}else{numberOfEmptyRequests=0;onHistoryCallback(data,{noData:false});}}catch(e){onHistoryCallback([],{noData:true});}},resolveSymbol:async(symbolName,onSymbolResolvedCallback)=>{var _Number;const state=store.getState();const pricescale=(_Number=Number(state.futures.pair.pricescale))!==null&&_Number!==void 0?_Number:1;console.log('chart pricescale',pricescale);const symbol={ticker:symbolName,session:\"24x7\",timezone:getUserTimezone(),minmov:1,pricescale,has_intraday:true,has_weekly_and_monthly:false,volume_precision:1,data_status:\"streaming\"};setTimeout(()=>{onSymbolResolvedCallback(symbol);});},subscribeBars:(symbolInfo,resolution,onRealtimeCallback,subscriberUID// onResetCacheNeededCallback,\n)=>{console.log('[subscribeBars]: Method call with subscriberUID:',subscriberUID);subscribeOnStream(symbolInfo,resolution,onRealtimeCallback,subscriberUID// onResetCacheNeededCallback,\n// lastBarsCache.get(symbolInfo.full_name),\n);},unsubscribeBars:subscriberUID=>{console.log('[unsubscribeBars]: Method call with subscriberUID:',subscriberUID);unsubscribeFromStream(subscriberUID);}};","map":{"version":3,"names":["axios","getUserTimezone","subscribeOnStream","unsubscribeFromStream","store","configurationData","supported_resolutions","numberOfEmptyRequests","onReady","callback","setTimeout","getBars","symbolInfo","resolution","periodParams","onHistoryCallback","from","Math","floor","to","intervalMap","interval","resp","get","params","symbol","ticker","toLowerCase","startTime","endTime","limit","data","map","obj","time","open","parseFloat","high","low","close","volume","length","noData","nextTime","e","resolveSymbol","symbolName","onSymbolResolvedCallback","_Number","state","getState","pricescale","Number","futures","pair","console","log","session","timezone","minmov","has_intraday","has_weekly_and_monthly","volume_precision","data_status","subscribeBars","onRealtimeCallback","subscriberUID","unsubscribeBars"],"sources":["/Users/admin/Desktop/untitled folder/bo_react_test/src/components/pages/Futures/components/FuturesWidget/datafeed.js"],"sourcesContent":["import axios from \"axios\";\nimport {getUserTimezone} from \"@helpers/timezone\";\nimport {subscribeOnStream, unsubscribeFromStream} from \"./streaming\";\nimport store from \"../../../../../redux/store\";\n\nconst configurationData = {\n  supported_resolutions: [\"1\", \"5\", \"10\", \"15\", \"30\"],\n};\n\nlet numberOfEmptyRequests = 0;\n\nexport default {\n  onReady: (callback) => {\n    setTimeout(() => callback(configurationData));\n  },\n  getBars: async (\n    symbolInfo,\n    resolution,\n    periodParams,\n    onHistoryCallback\n  ) => {\n    try {\n      let from = Math.floor(periodParams.from);\n      let to = Math.floor(periodParams.to);\n\n      const intervalMap = {\n        '1': '1m',\n        '5': '5m',\n        '15': '15m',\n        '30': '30m',\n        '60': '1h',\n        '240': '4h',\n        'D': '1d',\n        'W': '1w',\n        'M': '1M'\n      };\n\n      const interval = intervalMap[resolution] || '1m';\n\n      const resp = await axios.get(\n        `https://fapi.binance.com/fapi/v1/klines`,\n        {\n          params: {\n            symbol: symbolInfo.ticker.toLowerCase(),\n            interval: interval,\n            startTime: from * 1000,\n            endTime: to * 1000,\n            limit: 1000\n          }\n        }\n      );\n\n      const data = resp.data.map((obj) => ({\n        time: obj[0],\n        open: parseFloat(obj[1]),\n        high: parseFloat(obj[2]),\n        low: parseFloat(obj[3]),\n        close: parseFloat(obj[4]),\n        volume: parseFloat(obj[5])\n      }));\n\n      if (data.length < 1) {\n        numberOfEmptyRequests += 1;\n        if (numberOfEmptyRequests > 3) {\n          onHistoryCallback([], {noData: true});\n        } else {\n          onHistoryCallback([], {\n            nextTime: periodParams.from - 86400\n          });\n        }\n      } else {\n        numberOfEmptyRequests = 0;\n        onHistoryCallback(data, {noData: false});\n      }\n    } catch (e) {\n      onHistoryCallback([], {noData: true});\n    }\n  },\n  resolveSymbol: async (symbolName, onSymbolResolvedCallback) => {\n    const state = store.getState();\n\n    const pricescale  = Number(state.futures.pair.pricescale) ?? 1;\n\n    console.log('chart pricescale', pricescale);\n    \n    const symbol = {\n      ticker: symbolName,\n      session: \"24x7\",\n      timezone: getUserTimezone(),\n      minmov: 1,\n      pricescale,\n      has_intraday: true,\n      has_weekly_and_monthly: false,\n      volume_precision: 1,\n      data_status: \"streaming\",\n    };\n\n    setTimeout(() => {\n      onSymbolResolvedCallback(symbol);\n    })\n  },\n  subscribeBars: (\n    symbolInfo,\n    resolution,\n    onRealtimeCallback,\n    subscriberUID,\n    // onResetCacheNeededCallback,\n  ) => {\n    console.log('[subscribeBars]: Method call with subscriberUID:', subscriberUID);\n    subscribeOnStream(\n      symbolInfo,\n      resolution,\n      onRealtimeCallback,\n      subscriberUID,\n      // onResetCacheNeededCallback,\n      // lastBarsCache.get(symbolInfo.full_name),\n    );\n  },\n  unsubscribeBars: (subscriberUID) => {\n    console.log('[unsubscribeBars]: Method call with subscriberUID:', subscriberUID);\n    unsubscribeFromStream(subscriberUID);\n  },\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}