{"ast":null,"code":"import _objectSpread from\"/Users/admin/Desktop/untitled folder/bo_react_test/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import axios from\"axios\";import store from\"../../../../../redux/store\";import moment from\"moment-timezone\";import{formatUTC,getAdjustedTime,getUserTimezone}from\"@helpers/timezone\";import config from\"../../../../../config\";import{subscribeOnStream,unsubscribeFromStream}from\"./streaming\";const configurationData={supported_resolutions:[\"1\",\"5\",\"10\",\"15\",\"30\"]};let numberOfEmptyRequests=0;export default{onReady:callback=>{setTimeout(()=>callback(configurationData));},getBars:async(symbolInfo,resolution,periodParams,onHistoryCallback)=>{try{let from,to;const currentDay=moment().utc().day();const{from:periodFrom,to:periodTo,firstDataRequest}=periodParams;if(currentDay===6||currentDay===0){const dayOffset=currentDay===6?1:2;from=getAdjustedTime(periodFrom,dayOffset,\"days\");to=getAdjustedTime(periodTo,dayOffset,\"days\");}else{from=getAdjustedTime(periodTo,2,\"days\");to=formatUTC(periodTo);if(firstDataRequest){to=getAdjustedTime(periodTo,1,\"minute\");}}const resp=await axios.get(\"https://marketdata.tradermade.com/api/v1/timeseries?currency=\".concat(symbolInfo.ticker,\"&api_key=\").concat(config.tradermade_key,\"&start_date=\").concat(from,\"&end_date=\").concat(to,\"&format=records&period=\").concat(resolution,\"&interval=minute\"));const data=resp.data.quotes.map(obj=>{return _objectSpread({time:moment(obj.date).utc(obj.date).tz(getUserTimezone()).valueOf()},obj);});if(data.length<1){numberOfEmptyRequests+=1;if(numberOfEmptyRequests>3){onHistoryCallback([],{noData:true});}else{onHistoryCallback([],{nextTime:moment(periodParams.from*1000).utc().tz(getUserTimezone()).subtract(1,\"days\").unix()});}}else{numberOfEmptyRequests=0;onHistoryCallback(data,{noData:false});}}catch(e){onHistoryCallback([],{noData:true});}},resolveSymbol:async(symbolName,onSymbolResolvedCallback)=>{const state=store.getState();const pricescale=Number(state.trading.pair.pricescale)?Number(state.trading.pair.pricescale):1;const symbol={ticker:symbolName,session:\"24x7\",timezone:getUserTimezone(),minmov:1,pricescale,has_intraday:true,has_weekly_and_monthly:false,volume_precision:1,data_status:\"streaming\"};setTimeout(()=>{onSymbolResolvedCallback(symbol);});},subscribeBars:(symbolInfo,resolution,onRealtimeCallback,subscriberUID// onResetCacheNeededCallback,\n)=>{console.log('[subscribeBars]: Method call with subscriberUID:',subscriberUID);subscribeOnStream(symbolInfo,resolution,onRealtimeCallback,subscriberUID// onResetCacheNeededCallback,\n// lastBarsCache.get(symbolInfo.full_name),\n);},unsubscribeBars:subscriberUID=>{console.log('[unsubscribeBars]: Method call with subscriberUID:',subscriberUID);unsubscribeFromStream(subscriberUID);}};","map":{"version":3,"names":["axios","store","moment","formatUTC","getAdjustedTime","getUserTimezone","config","subscribeOnStream","unsubscribeFromStream","configurationData","supported_resolutions","numberOfEmptyRequests","onReady","callback","setTimeout","getBars","symbolInfo","resolution","periodParams","onHistoryCallback","from","to","currentDay","utc","day","periodFrom","periodTo","firstDataRequest","dayOffset","resp","get","concat","ticker","tradermade_key","data","quotes","map","obj","_objectSpread","time","date","tz","valueOf","length","noData","nextTime","subtract","unix","e","resolveSymbol","symbolName","onSymbolResolvedCallback","state","getState","pricescale","Number","trading","pair","symbol","session","timezone","minmov","has_intraday","has_weekly_and_monthly","volume_precision","data_status","subscribeBars","onRealtimeCallback","subscriberUID","console","log","unsubscribeBars"],"sources":["/Users/admin/Desktop/untitled folder/bo_react_test/src/components/pages/Trading/components/TradingViewWidget/datafeed.js"],"sourcesContent":["import axios from \"axios\";\nimport store from \"../../../../../redux/store\";\nimport moment from \"moment-timezone\";\nimport {formatUTC, getAdjustedTime, getUserTimezone} from \"@helpers/timezone\";\nimport config from \"../../../../../config\";\nimport {\n  subscribeOnStream,\n  unsubscribeFromStream\n} from \"./streaming\";\n\nconst configurationData = {\n  supported_resolutions: [\"1\", \"5\", \"10\", \"15\", \"30\"],\n};\n\nlet numberOfEmptyRequests = 0;\n\nexport default {\n  onReady: (callback) => {\n    setTimeout(() => callback(configurationData));\n  },\n  getBars: async (\n    symbolInfo,\n    resolution,\n    periodParams,\n    onHistoryCallback\n  ) => {\n    try {\n      let from, to;\n\n      const currentDay = moment().utc().day();\n      const {from: periodFrom, to: periodTo, firstDataRequest} = periodParams;\n\n      if (currentDay === 6 || currentDay === 0) {\n        const dayOffset = currentDay === 6 ? 1 : 2;\n\n        from = getAdjustedTime(periodFrom, dayOffset, \"days\");\n        to = getAdjustedTime(periodTo, dayOffset, \"days\");\n\n      } else {\n        from = getAdjustedTime(periodTo, 2, \"days\");\n        to = formatUTC(periodTo);\n\n        if (firstDataRequest) {\n          to = getAdjustedTime(periodTo, 1, \"minute\");\n        }\n      }\n\n      const resp = await axios.get(\n        `https://marketdata.tradermade.com/api/v1/timeseries?currency=${symbolInfo.ticker}&api_key=${config.tradermade_key}&start_date=${from}&end_date=${to}&format=records&period=${resolution}&interval=minute`\n      );\n\n      const data = resp.data.quotes.map((obj) => {\n        return {\n          time: moment(obj.date).utc(obj.date).tz(getUserTimezone()).valueOf(),\n          ...obj,\n        };\n      });\n\n      if (data.length < 1) {\n        numberOfEmptyRequests += 1;\n\n        if (numberOfEmptyRequests > 3) {\n          onHistoryCallback([], {noData: true});\n        } else {\n          onHistoryCallback([], {\n            nextTime: moment(periodParams.from * 1000)\n              .utc()\n              .tz(getUserTimezone())\n              .subtract(1, \"days\")\n              .unix()\n          });\n        }\n      } else {\n        numberOfEmptyRequests = 0;\n        onHistoryCallback(data, {noData: false});\n      }\n    } catch (e) {\n      onHistoryCallback([], {noData: true});\n    }\n  },\n  resolveSymbol: async (symbolName, onSymbolResolvedCallback) => {\n    const state = store.getState();\n\n    const pricescale = Number(state.trading.pair.pricescale)\n      ? Number(state.trading.pair.pricescale)\n      : 1;\n\n    const symbol = {\n      ticker: symbolName,\n      session: \"24x7\",\n      timezone: getUserTimezone(),\n      minmov: 1,\n      pricescale,\n      has_intraday: true,\n      has_weekly_and_monthly: false,\n      volume_precision: 1,\n      data_status: \"streaming\",\n    };\n\n    setTimeout(() => {\n      onSymbolResolvedCallback(symbol);\n    })\n  },\n  subscribeBars: (\n    symbolInfo,\n    resolution,\n    onRealtimeCallback,\n    subscriberUID,\n    // onResetCacheNeededCallback,\n  ) => {\n    console.log('[subscribeBars]: Method call with subscriberUID:', subscriberUID);\n    subscribeOnStream(\n      symbolInfo,\n      resolution,\n      onRealtimeCallback,\n      subscriberUID,\n      // onResetCacheNeededCallback,\n      // lastBarsCache.get(symbolInfo.full_name),\n    );\n  },\n  unsubscribeBars: (subscriberUID) => {\n    console.log('[unsubscribeBars]: Method call with subscriberUID:', subscriberUID);\n    unsubscribeFromStream(subscriberUID);\n  },\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}