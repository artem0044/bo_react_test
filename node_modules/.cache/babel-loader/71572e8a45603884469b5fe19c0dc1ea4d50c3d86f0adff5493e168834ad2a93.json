{"ast":null,"code":"import{throttle}from\"lodash\";const channelToSubscription=new Map();export const subscribeOnStream=(symbolInfo,resolution,onRealtimeCallback,subscriberUID)=>{const symbol=symbolInfo.ticker.toLowerCase();const interval=resolution.toString();const streamUrl=\"wss://fstream.binance.com/ws/\".concat(symbol,\"@kline_\").concat(interval,\"m\");const channelString=\"\".concat(symbol,\"@kline_\").concat(interval,\"m\");const handler={id:subscriberUID,callback:onRealtimeCallback};let subscriptionItem=channelToSubscription.get(channelString);if(subscriptionItem){subscriptionItem.handlers.push(handler);return;}const ws=new WebSocket(streamUrl);const throttledCallback=throttle(realTimeData=>{for(const h of subscriptionItem.handlers){h.callback(realTimeData);}},500);ws.onmessage=function(event){const data=JSON.parse(event.data);if(data!==null&&data!==void 0&&data.ping){ws.send(JSON.stringify({pong:data.ping}));return;}const k=data.k;const realTimeData={time:k.t,// start time of this candle\nopen:parseFloat(k.o),high:parseFloat(k.h),low:parseFloat(k.l),close:parseFloat(k.c)};throttledCallback(realTimeData);};subscriptionItem={subscriberUID,resolution,handlers:[handler],socket:ws};channelToSubscription.set(channelString,subscriptionItem);};export const unsubscribeFromStream=subscriberUID=>{for(const[channelString,subscriptionItem]of channelToSubscription.entries()){const handlerIndex=subscriptionItem.handlers.findIndex(handler=>handler.id===subscriberUID);if(handlerIndex!==-1){subscriptionItem.handlers.splice(handlerIndex,1);if(subscriptionItem.handlers.length===0){subscriptionItem.socket.close();channelToSubscription.delete(channelString);break;}}}};","map":{"version":3,"names":["throttle","channelToSubscription","Map","subscribeOnStream","symbolInfo","resolution","onRealtimeCallback","subscriberUID","symbol","ticker","toLowerCase","interval","toString","streamUrl","concat","channelString","handler","id","callback","subscriptionItem","get","handlers","push","ws","WebSocket","throttledCallback","realTimeData","h","onmessage","event","data","JSON","parse","ping","send","stringify","pong","k","time","t","open","parseFloat","o","high","low","l","close","c","socket","set","unsubscribeFromStream","entries","handlerIndex","findIndex","splice","length","delete"],"sources":["/Users/admin/Desktop/untitled folder/bo_react_test/src/components/pages/Futures/components/FuturesWidget/streaming.js"],"sourcesContent":["import {throttle} from \"lodash\";\n\nconst channelToSubscription = new Map();\n\nexport const subscribeOnStream = (symbolInfo, resolution, onRealtimeCallback, subscriberUID) => {\n  const symbol = symbolInfo.ticker.toLowerCase(); \n  const interval = resolution.toString();\n  const streamUrl = `wss://fstream.binance.com/ws/${symbol}@kline_${interval}m`;\n  const channelString = `${symbol}@kline_${interval}m`;\n\n  const handler = {\n    id: subscriberUID,\n    callback: onRealtimeCallback,\n  };\n\n  let subscriptionItem = channelToSubscription.get(channelString);\n  if (subscriptionItem) {\n    subscriptionItem.handlers.push(handler);\n    return;\n  }\n\n  const ws = new WebSocket(streamUrl);\n\n  const throttledCallback = throttle((realTimeData) => {\n    for (const h of subscriptionItem.handlers) {\n      h.callback(realTimeData);\n    }\n  }, 500);\n\n  ws.onmessage = function (event) {\n    const data = JSON.parse(event.data);\n\n    if (data?.ping) {\n      ws.send(JSON.stringify({pong: data.ping}));\n      return;\n    }\n    \n    const k = data.k;\n\n    const realTimeData = {\n      time: k.t, // start time of this candle\n      open: parseFloat(k.o),\n      high: parseFloat(k.h),\n      low: parseFloat(k.l),\n      close: parseFloat(k.c),\n    };\n\n    throttledCallback(realTimeData);\n  };\n\n  subscriptionItem = {\n    subscriberUID,\n    resolution,\n    handlers: [handler],\n    socket: ws,\n  };\n\n  channelToSubscription.set(channelString, subscriptionItem);\n};\n\n\nexport const unsubscribeFromStream = (subscriberUID) => {\n  for (const [channelString, subscriptionItem] of channelToSubscription.entries()) {\n    const handlerIndex = subscriptionItem.handlers.findIndex(\n      (handler) => handler.id === subscriberUID\n    );\n\n    if (handlerIndex !== -1) {\n      subscriptionItem.handlers.splice(handlerIndex, 1);\n      if (subscriptionItem.handlers.length === 0) {\n        subscriptionItem.socket.close();\n        channelToSubscription.delete(channelString);\n        break;\n      }\n    }\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}